<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MONAD EXIT — GOD MODE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@300;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(-45deg, #0a001f, #1a0033, #000428, #120030);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
    }
    @keyframes gradient { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
    .glow { box-shadow: 0 0 40px rgba(168,85,247,0.6); }
    .pulse { animation: pulse 3s infinite alternate; }
    @keyframes pulse { from { box-shadow: 0 0 30px rgba(168,85,247,0.4); } to { box-shadow: 0 0 60px rgba(168,85,247,0.9); } }
    .orb { position: fixed; border-radius: 50%; background: radial-gradient(circle, rgba(168,85,247,0.3), transparent); filter: blur(60px); pointer-events: none; z-index: -1; }
  </style>
</head>
<body class="relative text-white overflow-hidden">

  <div class="orb top-0 left-0 w-96 h-96 animate-pulse"></div>
  <div class="orb bottom-0 right-0 w-80 h-80 animate-pulse delay-700"></div>

  <div class="min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-6xl mx-auto">

      <!-- Header -->
      <div class="text-center mb-16">
        <h1 class="text-8xl md:text-9xl font-black tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-purple-400 via-pink-500 to-purple-600 glow pulse">
          MONAD EXIT
        </h1>
        <p class="text-2xl mt-6 font-light opacity-80">Deposit MON • Exit instantly • No trust required</p>
      </div>

      <!-- CONNECT CARD (Visible until connected) -->
      <div id="connectCard" class="glass rounded-3xl p-16 max-w-2xl mx-auto text-center glow pulse">
        <h2 class="text-5xl font-bold mb-10">Connect Your Wallet</h2>
        <p class="text-xl opacity-70 mb-12">This dApp runs exclusively on <span class="text-purple-2xl font-bold text-purple-400">Monad Mainnet</span></p>

        <!-- Wallet Buttons -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-lg mx-auto">
          <button id="metamaskBtn" class="glass p-8 rounded-2xl hover:scale-110 transition-all glow border border-purple-500/50">
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask" class="w-16 h-16 mx-auto mb-4">
            <p class="text-xl font-bold">MetaMask</p>
          </button>
          <button id="walletconnectBtn" class="glass p-8 rounded-2xl hover:scale-110 transition-all glow border border-pink-500/50">
            <img src="https://walletconnect.com/_next/static/media/walletconnect-logo.svg" alt="WalletConnect" class="w-16 h-16 mx-auto mb-4 filter brightness-0 invert">
            <p class="text-xl font-bold">WalletConnect</p>
          </button>
        </div>

        <p id="status" class="mt-10 text-lg text-yellow-300"></p>
      </div>

      <!-- MAIN APP (Hidden until connected) -->
      <div id="app" class="hidden space-y-12">

        <div class="glass rounded-3xl p-10 text-center glow">
          <p class="text-2xl opacity-80">Connected</p>
          <p id="walletAddr" class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-500 mt-2"></p>
        </div>

        <div class="grid md:grid-cols-2 gap-12">

          <!-- DEPOSIT -->
          <div class="glass rounded-3xl p-12 glow border border-green-500/30 hover:border-green-400 transition-all">
            <h3 class="text-6xl font-black text-green-400 mb-8">DEPOSIT</h3>
            <input id="amount" type="text" placeholder="420.69" class="w-full bg-black/30 border border-purple-500/50 rounded-2xl px-8 py-6 text-3xl text-center focus:outline-none focus:ring-4 focus:ring-green-500"/>
            <button id="depositBtn" class="mt-10 w-full py-8 text-3xl font-black rounded-2xl bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 transform hover:scale-105 transition-all shadow-2xl">
              DEPOSIT MON
            </button>
            <p class="mt-10 text-2xl">Your Balance: <span id="userBal" class="text-5xl font-black text-green-400">0</span> MON</p>
          </div>

          <!-- EXIT -->
          <div class="glass rounded-3xl p-12 glow border border-red-500/30 hover:border-red-400 transition-all">
            <h3 class="text-6xl font-black text-red-400 mb-8">EXIT</h3>
            <button id="exitBtn" class="w-full py-10 text-4xl font-black rounded-2xl bg-gradient-to-r from-red-600 to-pink-700 hover:from-red-500 hover:to-pink-600 transform hover:scale-110 transition-all shadow-2xl">
              WITHDRAW ALL
            </button>
            <p class="mt-10 text-2xl">You get back: <span id="exitBal" class="text-5xl font-black text-red-400">0</span> MON</p>
          </div>
        </div>

        <div class="glass rounded-3xl p-10 text-center glow">
          <p class="text-3xl opacity-80">Total Locked in Contract</p>
          <p class="text-8xl font-black mt-6 bg-clip-text text-transparent bg-gradient-to-r from-yellow-400 to-orange-500">
            <span id="totalLocked">0</span> MON
          </p>
        </div>

        <div class="text-center mt-16 text-gray-400">
          Contract: <code class="text-purple-300 text-lg break-all">0xc6c0db193c8f590ae8e80b8c7aCcdB1BC5A4E9c3</code>
          <br><a href="https://monad-vision.vercel.app/address/0xc6c0db193c8f590ae8e80b8c7aCcdB1BC5A4E9c3" target="_blank" class="underline hover:text-white">View on Explorer</a>
        </div>
      </div>
    </div>
  </div>

<script src="https://unpkg.com/@walletconnect/modal@2.6.2/dist/index.js"></script>
<script>
// CONTRACT
const CONTRACT = "0xc6c0db193c8f590ae8e80b8c7aCcdB1BC5A4E9c3";
const ABI = ["function deposit() payable","function exit()","function balances(address) view returns (uint256)","function totalDeposited() view returns (uint256)"];

const MONAD = {
  chainId: 143,
  chainName: "Monad Mainnet",
  nativeCurrency: { name: "Monad", symbol: "MON", decimals: 18 },
  rpcUrls: ["https://rpc.monad.xyz"],
  blockExplorerUrls: ["https://monad-vision.vercel.app"]
};

let provider, signer, contract, address;

// Force Monad Network
async function switchToMonad() {
  try {
    await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x8f' }] });
  } catch (e) {
    if (e.code === 4902) {
      await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [MONAD] });
    } else throw e;
  }
}

// MetaMask Connect
document.getElementById("metamaskBtn").onclick = async () => {
  if (!window.ethereum) return alert("MetaMask not detected");
  document.getElementById("status").textContent = "Switching to Monad...";
  await switchToMonad();
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  initApp();
};

// WalletConnect v2
let wcProvider;
document.getElementById("walletconnectBtn").onclick = async () => {
  const modal = new WalletConnectModal.Modal({
    projectId: "YOUR_PROJECT_ID_IF_YOU_WANT", // optional but recommended
    chains: [143],
    themeMode: "dark",
    walletConnectVersion: 2
  });
  const session = await modal.connect({ requiredNamespaces: { eip155: { chains: ['eip155:143'], methods: ['eth_sendTransaction','personal_sign'], events: ['chainChanged','accountsChanged'] }}});
  wcProvider = new ethers.providers.Web3Provider(new WalletConnectModal.EthereumProvider(session));
  provider = wcProvider;
  initApp();
};

async function initApp() {
  signer = provider.getSigner();
  address = await signer.getAddress();
  contract = new ethers.Contract(CONTRACT, ABI, signer);

  document.getElementById("walletAddr").textContent = address.slice(0,10)+"..."+address.slice(-8);
  document.getElementById("connectCard").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");

  refresh();
  setInterval(refresh, 7000);
}

async function refresh() {
  const bal = await contract.balances(address);
  const total = await contract.totalDeposited();
  const f = n => parseFloat(ethers.utils.formatEther(n)).toFixed(4);
  document.getElementById("userBal").textContent = f(bal);
  document.getElementById("exitBal").textContent = f(bal);
  document.getElementById("totalLocked").textContent = f(total);
}

document.getElementById("depositBtn").onclick = async () => {
  const amt = document.getElementById("amount").value;
  if (!amt || amt <= 0) return alert("Enter amount");
  const tx = await contract.deposit({ value: ethers.utils.parseEther(amt) });
  document.getElementById("status").textContent = "Depositing...";
  await tx.wait();
  alert(`Deposited ${amt} MON`);
  refresh();
};

document.getElementById("exitBtn").onclick = async () => {
  const bal = await contract.balances(address);
  if (bal.eq(0)) return alert("Nothing to exit");
  const tx = await contract.exit();
  await tx.wait();
  alert("EXITED — ALL MON RETURNED");
  refresh();
};
</script>
</body>
</html>
